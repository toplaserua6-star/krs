# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Tribute

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É

1. –í–æ–π–¥–∏—Ç–µ –≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç Tribute
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ: `https://web.tribute.tg/p/abc123`
4. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `config/payment.ts`
5. –ó–∞–º–µ–Ω–∏—Ç–µ `abc123` –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–µ `PAYMENT_LINK_ID` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π ID

```typescript
// –ë—ã–ª–æ:
export const PAYMENT_LINK_ID = 'abc123'

// –°—Ç–∞–ª–æ (–ø—Ä–∏–º–µ—Ä):
export const PAYMENT_LINK_ID = 'pm9H' // –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π ID
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook –≤ Tribute

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ Tribute
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª "Webhooks" –∏–ª–∏ "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"
3. –£–∫–∞–∂–∏—Ç–µ Webhook URL:
   ```
   https://your-domain.vercel.app/api/tribute-webhook
   ```
   (–ó–∞–º–µ–Ω–∏—Ç–µ `your-domain.vercel.app` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω)

4. –£–∫–∞–∂–∏—Ç–µ Redirect URL –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã:
   ```
   https://your-domain.vercel.app/success
   ```

### 3. –î–µ–ø–ª–æ–π –Ω–∞ Vercel

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫ Vercel
2. –ü—Ä–∏ –¥–µ–ø–ª–æ–µ Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –¥–æ–º–µ–Ω
3. –û–±–Ω–æ–≤–∏—Ç–µ webhook URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Tribute –Ω–∞ –Ω–æ–≤—ã–π –¥–æ–º–µ–Ω

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å ngrok)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok: `npm install -g ngrok`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä: `npm run dev`
3. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏—Ç–µ ngrok:
   ```bash
   ngrok http 3000
   ```
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ HTTPS URL –∏–∑ ngrok (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://abc123.ngrok.io`)
5. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Tribute —É–∫–∞–∂–∏—Ç–µ:
   - Webhook URL: `https://abc123.ngrok.io/api/tribute-webhook`
   - Redirect URL: `https://abc123.ngrok.io/success`

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:

```bash
# GET –∑–∞–ø—Ä–æ—Å (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å { ok: true })
curl https://your-domain.vercel.app/api/tribute-webhook

# –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
# https://your-domain.vercel.app/api/tribute-webhook
```

### 5. –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç Tribute

Webhook –æ–∂–∏–¥–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç JSON:

```json
{
  "product_id": "string",
  "user_id": "string",
  "amount": 33,
  "currency": "USD",
  "status": "paid",
  "transaction_id": "string",
  "email": "user@example.com",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### 6. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã
2. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã Tribute
3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã Tribute:
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/tribute-webhook`
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ `/success`

4. Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å `status === "paid"`
   - –õ–æ–≥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Å–æ–ª—å
   - (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
   - (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email —Å –¥–æ—Å—Ç—É–ø–æ–º

### 7. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local`:

```env
NEXT_PUBLIC_WEBHOOK_URL=https://your-domain.vercel.app
NEXT_PUBLIC_SUCCESS_URL=https://your-domain.vercel.app/success
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

–í —Ñ–∞–π–ª–µ `app/api/tribute-webhook/route.ts` —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –±–ª–æ–∫ –∑–∞–ø–∏—Å–∏ –≤ –ë–î:

```typescript
// await db.purchases.create({
//   product_id: body.product_id,
//   user_id: body.user_id,
//   amount: body.amount,
//   currency: body.currency,
//   status: 'paid',
//   transaction_id: body.transaction_id,
//   email: body.email,
//   created_at: new Date()
// })
```

#### –û—Ç–ø—Ä–∞–≤–∫–∞ email

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É email —Å –¥–æ—Å—Ç—É–ø–æ–º:

```typescript
// await sendEmail({
//   to: body.email,
//   subject: '–î–æ—Å—Ç—É–ø –∫ –∫—É—Ä—Å—É ChatGPT –≤ –î–µ–ª–µ 5.0',
//   template: 'course-access',
//   data: { userId: body.user_id }
// })
```

### 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

- **Vercel**: Dashboard ‚Üí Deployment ‚Üí Logs
- **–õ–æ–∫–∞–ª—å–Ω–æ**: –ö–æ–Ω—Å–æ–ª—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `npm run dev`

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í production –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ webhook –æ—Ç Tribute (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
2. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: Webhook –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 200 OK –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö, –∏–Ω–∞—á–µ Tribute –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º Tribute –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production

### üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Vercel Dashboard
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ webhook URL –¥–æ—Å—Ç—É–ø–µ–Ω (–æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Tribute
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è

